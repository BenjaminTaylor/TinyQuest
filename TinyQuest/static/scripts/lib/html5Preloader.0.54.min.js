/* MIT License, see http://github.com/jussi-kalliokoski/html5Preloader.js */
var html5Preloader=(function(d){if(!d.XMLHttpRequest){var c=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(f){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(f){}return false}}else{var c=d.XMLHttpRequest}function e(h,g){for(var f=0;f<g.length;f++){if(g[f]===h){return true}}return false}function b(g,f,i){return g.addEventListener(f,function h(){g.removeEventListener(f,h);return i.apply(this,arguments)},true)}return function a(){var m=this,o=[],A=[],y=[],g=[],t=[],k=[],r,j,x,w,z,s,f,B,v,p=["jpg","png","apng","tiff","svg","jpeg","pnga","gif"];this.addFiles=function(){var E,D,I,F,L,C,H,G,K,J=[];for(E=0;E<arguments.length;E++){J=[];I=arguments[E].split("*:");F=I[0];L=I[I.length-1].split("||");for(D=0;D<L.length;D++){C=L[D].split(".");C=C[C.length-1].toLowerCase();H=u(C);if(H!="unsupported"){J.push({datatype:H,filepath:L[D]})}}if(K=J.shift()){A.push({identifier:F,datatype:K.datatype,filepath:K.filepath,alternates:J})}}if(A.length>0){G=m.active;m.active=true;if(!G){m.loadSequence()}}};this.loadSequence=function(){if(A.length<1){m.active=false;m.filesLoaded=0;m.nowLoading="";return m.onfinish()}cf=A.shift();if(!m.removeFile(cf.identifier)){m.filesLoaded++}m.nowLoading=cf.identifier;if(cf.datatype=="audio"){return q(cf)}if(cf.datatype=="video"){return n(cf)}if(cf.datatype=="image"){return h(cf)}if(cf.datatype=="document"){return l(cf)}};function u(i){if(e(i,y)){return"audio"}if(e(i,g)){return"video"}if(e(i,t)||e(i,k)){return"unsupported"}if(e(i,p)){return"image"}return"document"}function q(D){var i,C;try{i=new Audio()}catch(E){i=document.createElement("audio")}i.src=D.filepath;C=m;b(i,"canplaythrough",function(){C.loadSequence()});i.onerror=function(F){C.triggerError(F)};o.push({identifier:D.identifier,filepath:D.filepath,datatype:D.datatype,alternates:D.alternates,data:i});i.load()}function n(D){var i,C;try{i=new Video()}catch(E){i=document.createElement("video")}i.src=D.filepath;C=m;b(i,"canplaythrough",function(){C.loadSequence()});i.addEventListener("canplaythrough",function(){C.loadSequence()},true);i.onerror=function(F){C.triggerError(F)};o.push({identifier:D.identifier,filepath:D.filepath,datatype:D.datatype,alternates:D.alternates,data:i});i.load()}function h(D){var C=new Image(),i=m;C.src=D.filepath;C.onload=function(){i.loadSequence()};C.onerror=function(E){i.triggerError(E)};o.push({identifier:D.identifier,filepath:D.filepath,datatype:D.datatype,alternates:D.alternates,data:C})}function l(E){o.push({identifier:E.identifier,filepath:E.filepath,datatype:E.datatype,alternates:E.alternates,data:false});var i=m,D=o[o.length-1],F=new c(),C=E.filepath;if(!F){i.triggerError("XHR not available.")}C+=((C.indexOf("?")===-1)?"?":"&")+"sprrnd="+Math.floor(Math.random()*99999);F.onreadystatechange=function(){if(this.readyState==4&&this.status==200){D.data=this.responseXML||this.responseText||"";if(!D.data){return}i.loadSequence()}};F.onerror=function(G){i.triggerError(G)};F.open("GET",C);F.send()}this.triggerError=function(F){var D,C,E;for(D=0;D<o.length;D++){if(o[D].identifier==m.nowLoading){C=o[D];break}}if(C.alternates.length>0){E=C.alternates.shift();C.filepath=E.filepath;C.datatype=E.datatype;A.unshift(C);m.removeFile(m.nowLoading);return m.loadSequence()}if(this.active&&this.onerror(F)){m.loadSequence()}};this.getProgress=function(){return m.filesLoaded/(m.filesLoaded+A.length)};this.getFile=function(D){for(var C=0;C<o.length;C++){if(o[C].identifier==D){return o[C].data}}};this.removeFile=function(D){for(var C=0;C<o.length;C++){if(o[C].identifier==D){return o.splice(C,1)}}return false};r=!!(document.createElement("audio").canPlayType);j=["audio/mpeg","audio/ogg","audio/wav"];x=[["mp3"],["ogg"],["wav"]];w=!!(document.createElement("video").canPlayType);z=["video/mp4","video/ogg","video/divx"];s=[["mp4","mpeg","mpg"],["ogv","oga"],["dvx","divx","xdiv"]];if(r){f=document.createElement("audio");for(v=0;v<j.length;v++){if("no"!=f.canPlayType(j[v])&&""!=f.canPlayType(j[v])){y=y.concat(x[v])}else{t=t.concat(x[v])}}}if(w){B=document.createElement("video");for(v=0;v<z.length;v++){if("no"!=B.canPlayType(z[v])&&""!=B.canPlayType(z[v])){g=g.concat(s[v])}else{k=k.concat(s[v])}}}this.addFiles.apply(this,arguments)}})(this);html5Preloader.prototype={active:false,filesLoaded:0,nowLoading:"",version:0.54,onfinish:function(){},onerror:function(a){return true}};html5Preloader.prototype.rotaryGraph={angle:0,color:"white",scale:1,customText:""};html5Preloader.prototype.drawRotary=function(b,a,e){b.save();b.translate(a/2,e/2);var d=Math.min(Math.floor(a/80),Math.floor(e/60))*this.rotaryGraph.scale,f="Finished!",c;if(this.active){f="Loading "+this.nowLoading+"... ("+Math.floor(this.getProgress()*100)+"%)"}if(this.rotaryGraph.customText!=""){f=this.rotaryGraph.customText}b.lineWidth=d;b.lineCap="round";b.strokeStyle=this.rotaryGraph.color;b.fillStyle=this.rotaryGraph.color;if(!this.active){b.globalAlpha=0.5+0.05*Math.abs(this.rotaryGraph.angle-10)}for(i=0;i<20;i++){c=(this.active)?(20-this.rotaryGraph.angle+i)%20:10;if(this.active){b.globalAlpha=(0.5+c*0.025)}b.beginPath();b.moveTo(Math.sin(-Math.PI/10*i)*d*5,Math.cos(-Math.PI/10*i)*d*5);b.lineTo(Math.sin(-Math.PI/10*i)*d*15,Math.cos(-Math.PI/10*i)*d*15);b.stroke()}b.globalAlpha=1;b.font=d+"pt Arial";b.textAlign="center";b.fillText(f,0,d*20,d*40);b.restore();this.rotaryGraph.angle=(this.rotaryGraph.angle+1)%20};html5Preloader.prototype.version=0.54;
